<?/* *************************** How it works: ***********************************1) Session is reset, and page is refreshed2) Javascript waits three seconds, and then checks for session cookies set by other open pages	Y: Logout failed, display message	N: Logout successful!***************************************************************************** *///if(!isLoggedIn()) redirect($_SESSION['lastPage'],'You are Logged Out');setPagePref('deadEndPage','true');setPageConst('simplified','true');if(!$_REQUEST['default']) {	$_SERVER['serverdb']->execute("DELETE FROM buffers WHERE userId = '{$_SESSION['userId']}'");		$_SESSION['sessionCookie'] = ' '; //Overwrite current authenticated session cookie with nothing, which will cause a guest cookie to be created on the next page	$_SESSION = renderUser($_SERVER['REMOTE_ADDR'],'guest,ip');		redirect('logout-reset');}setPageConst('simplified','true');setPageConst('title','Deauthentication');setPageConst('bct','<a href="/index">Home</a> > Deauthentication');setPageBlock('block','Deauthentication','<div id="logoutText" class="ebox">	Your ATIServer Session has been deactivated.<br />	It is now safe to leave your computer!</div><script type="text/javascript"><!--	function getCookie(name) {		var dc = document.cookie;		var prefix = name + "=";		var begin = dc.indexOf("; " + prefix);		if (begin == -1) {			begin = dc.indexOf(prefix);			if (begin != 0) return "";		} else {			begin += 2;		}		var end = dc.indexOf(";", begin);		if (end == -1) end = dc.length;		return unescape(dc.substring(begin + prefix.length, end));	}	function isLoggedOut() {		if (getCookie("atid").length < 32) document.getElementById("logoutText").innerHTML = "<h4>Logout successful:</h4>It is now safe to leave your computer.";		else document.getElementById("logoutText").innerHTML = "<h4>Logout appears to have been unsuccessful.</h4>Please make sure you don\'t have pages from this site open in any other windows or tabs.<br /><br />Quitting your browser, or navigating away from this site, will log you out automatically.";	}	setInterval("isLoggedOut()",3000);	document.getElementById("logoutText").innerHTML = "<h4>Your ATIServer session is being deactivated...</h4>This process takes about 3 seconds.";--></script>');?>