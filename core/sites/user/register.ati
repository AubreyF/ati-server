<?setPagePref('deadEndPage');setPageConst('simplified','true');// http://marsxplr.com/view-14370redirect('/user/login', 'Registration sunset');if(isLoggedIn()) redirect($_SESSION['lastPage'],'Why Register when you\'re already logged in?');//*** Initialize customizable variables through ATIServer modular interface ****$vars['title'] = 'Welcome To '.ucwords($_SERVER["HTTP_HOST_TOP"]).'!';$vars['message'] = "	Thanks for registering at ".ucwords($_SERVER["HTTP_HOST_TOP"])."!<br />	Your new account is recognized on all the sites in the <a href=\"http://TheATI.net\">ATI Network</a>.<br />	Registration information follows:";if(file_exists(_site.'/_mod/_user/register.atii')) include _site.'/_mod/_user/register.atii';//***************************** Handle Submissions *****************************if ($_POST) {	if(!$_POST['username'])		$errors .= "<li>Missing Username</li>";	else if(($temp = preg_replace('/[^A-Za-z0-9\_]/', '', $_POST['username'])) != $_POST['username']) {		$_POST['username'] = $temp;		$errors .= '<li>Please use only letters numbers, dashes, and underscores in your username</li>';	}	else if(renderUser("`userName` = '{$_POST['username']}'", 'member,preFormatted,mode=checkIfExists') == true) $errors .= "<li>There is already a member with that username. Please choose another one!</li>";	if(!$_POST['password']){		$errors .= "<li>Missing Password</li>";		$_POST['password2'] = '';	}	else if(!$_POST['password2']){		$errors .= "<li>Missing Password Verification</li>";		$_POST['password'] = '';	}	else if($_POST['password'] != $_POST['password2']){		$errors .= "<li>Passwords do not match!</li>";		$_POST['password'] = '';		$_POST['password2'] = '';	}	if(!$_POST['email_address'])	$errors .= "<li>Missing Email Address</li>";	else if(!$_POST['email_address2'])	$errors .= "<li>Missing Email Address Verification</li>";	else if($_POST['email_address'] != $_POST['email_address2']) $errors .= "<li>Email addresses do not match!</li>";	//else if(!checkEmail($_POST['email_address'])) $notes .= "<li>Your email address does not appear valid. (Please verify that it is your correct address)</li>";	else if(renderUser("`userEmail` = '{$_POST['email_address']}'", 'member,preFormatted,mode=checkIfExists') == true) $errors .= "<li>There is already a member with that email address. If you have already registered, please go back to the login page and use the \"Lost Password\" form.</li>";	if($_POST['location']) {		$location = func(_mod.'location','getLocation',$_REQUEST['location']);		//if(!$location) $errors .= "<li>Please enter your location as \"City, State\", \"City ST\", or \"zipcode\"<br /><i>Location is an optional field, so you can leave it blank if it doesn't work</i></li>";	}	if($_POST['phone_number']){		$_POST['phone_number'] = undoPhone($_POST['phone_number']);		if(strlen($_POST['phone_number']) < 10) {			$notes .= "<li>Your phone number does not appear valid!</li>";		}	}   	if($errors) {		$errors = '<div class="ebox"><h3>Submission Notes:</h3><ul>'.$errors.'</ul></div>';	} else if($notes && $_POST['submit'] != 'Ignore Possible Errors') {		$errors = '<div class="nbox"><h3>There were possible errors with Your submission:</h3>		<ul>'.$notes.'</ul>		<em>Please make any required changes and press "Create My Account" again, or</em><br /><br /><input name="submit" type="submit" value="Ignore Possible Errors"></div>';	}	else {		$oldSession = $_SESSION;		$_SESSION['userId'] 		= random('unique');		$_SESSION['userName'] 		= $_POST['username'];		$_SESSION['userRealName'] 	= $_POST['real_name'];		$_SESSION['userEmail'] 		= $_POST['email_address'];		$_SESSION['userSignupDate']	= time();		$_SESSION['userBio'] 		= nl2br($_POST['bio']);		$_SESSION['userPassword'] 	= $_POST['password'];		$_SESSION['userPhone'] 		= $_POST['phone_number'];		$_SESSION['userPower']		= 1.00;		$_SESSION['sessionCookie'] = md5($_SESSION['userPassword'].$_SESSION['userSignupDate']).$_SESSION['userId'];		$_SESSION['registrationSite'] = $_SERVER['FAKE_HOST'];		if($location) {			$_SESSION['userZip']		= $location['zip'];			$_SESSION['userCity'] 		= $location['city'];			$_SESSION['userState'] 		= $location['state'];			$_SESSION['userLatitude']	= $location['latitude'];			$_SESSION['userLongitude']	= $location['longitude'];			$_SESSION['userDST']		= $location['dst'];			$_SESSION['userLocation']	= $location['city'].', '.$location['state'];		}		else {			$_SESSION['userZip']		= '';			$_SESSION['userCity'] 		= '';			$_SESSION['userLatitude']	= '';			$_SESSION['userLongitude']	= '';			$_SESSION['userDST']		= '';			$_SESSION['userLocation'] 	= $_POST['location'];		}		$_SESSION['userVisits'] = 0;		$_SESSION['userHits'] = 0;		$_SESSION['userTIme'] = 0;		//Send Welcome PM		func(_mod.'pm','pmSend',$_SESSION['userName'],$vars['title'],		$vars['message'].		"<br /><br />Username: {$_SESSION['userName']}<br />".		"Password: {$_SESSION['userPassword']}<br />".		"Email Address: {$_SESSION['userEmail']}"		,array('from'=>'robot','skipErrors'=>true,'userEmail'=>$_SESSION['userEmail'],'autoForwardEnabled'=>true));		//Preserve old buffers!		$_SERVER['serverdb']->execute("UPDATE buffers SET userId = '{$_SESSION['userId']}' WHERE userId = '{$oldSession['userId']}'");		redirect('/user/login-mode-cookiecheck','<b>Thanks for Registering, '.$_SESSION['userName'].'!</b><br /><em>You have been automatically logged in, and can get back to what you were working on.</em>',2);	}}setPageConst('title','ATI Tools > Login > Register!');setPageConst('bct','<a href="/index">Home</a> > <a href="/user/login">Authentication</a> > Create Account');setPage(pFunc('blockFancy','Create Account','<form enctype="multipart/form-data" method="post">'.$errors.'  <table class="columns">  <tr>  <td class="column" style="width:50%;">	<table class="outer">	  <tr><th colspan="2">Required:</th></tr>      <tr>        <td class="lcol">Username</td>        <td class="rcol"><input class="input" name="username" type="text" id="username" value="'.$_POST['username'].'"></td>      </tr>	  <tr><td class="srow" colspan="2"></td></tr>      <tr>        <td class="lcol">Password</td>        <td class="rcol"><input class="input" name="password" type="password" id="password" value="'.$_POST['password'].'"></td>      </tr>      <tr>        <td class="lcol">Verify Password</td>        <td class="rcol"><input class="input" name="password2" type="password" id="password2" value="'.$_POST['password2'].'"></td>      </tr>	  <tr><td class="srow" colspan="2"></td></tr>	   <tr>        <td class="lcol">Email Address</td>        <td class="rcol"><input class="input" name="email_address" type="text" id="email_address" value="'.$_POST['email_address'].'"></td>      </tr>      <tr>        <td class="lcol">Verify Email Address</td>        <td class="rcol"><input class="input" name="email_address2" type="text" id="email_address2" value="'.$_POST['email_address2'].'"></td>      </tr>    </table></td>    <td class="column" style="width:50%;">	<table class="outer">   	  <tr><th colspan="2">Optional:</th></tr>      <tr>        <td class="lcol">Real Name</td>        <td class="rcol"><input class="input" name="real_name" type="text" id="real_name" value="'.$_POST['real_name'].'"></td>      </tr>      <tr>        <td class="lcol">Phone Number</td>        <td class="rcol"><input class="input" name="phone_number" type="text" id="phone_number" value="'.$_POST['phone_number'].'"></td>      </tr>      <tr>        <td class="lcol">Your Location</td>        <td class="rcol"><input class="input" name="location" type="text" id="location" value="'.$_POST['location'].'"></td>      </tr>	  <tr>        <td class="lcol">About You</td>        <td class="rcol">			<textarea class="input" name="bio" type="text" id="bio" style="height:90px;">'.$_POST['bio'].'</textarea></em>		</td>      </tr>    </table>	</td>  </tr></table><br /><br /><input name="req" type="hidden" id="req" value="process"><input id="submit" type="submit" name="Submit" class="bold" value="Create my Account!"><div class="content slender desc">	• Your new account is good for all sites in the <a href="http://'.ATIHOME.'" target="_blank">ATI Network</a>	<br />	• We take your privacy <a href="http://theati.net.loc/legal" target="_blank">Seriously</a></div></form>'));?>