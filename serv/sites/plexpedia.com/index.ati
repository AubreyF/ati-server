<?if($_SESSION['groupName']) {		setPageConst('title',$_SESSION['plexpediaGroup']['description']);	setPageBlock('block','Welcome',$_SESSION['plexpediaGroup']['homeText']);	} else {		setPageConst('title','The Online Compendium of Knowledge');	}SetPageConst('showAds',false,'skin');setPageTpl('index');setPage('<link rel="alternate" type="application/rss+xml" title="Latest Threads!" href="http://'.$_SERVER['HTTP_HOST'].'/export.atis-tpl-rss" />','head');if($_SESSION['plexpediaGroup']['text']['homeStyle'] != 't') {	$showNew = ($_SESSION['plexpediaGroup']['text']['homeStyle'] != 'c' && isLoggedIn() && $_REQUEST['c'] != 'r');		if(!$showNew) {		$sql = "		SELECT t.id, t.title, t.type, t.tags, t.description, t.state, t.submitTime, t.userId, t.views, t.picture, t.time".		(isLoggedIn() ? ", r.readTime FROM forum_threads t LEFT JOIN forum_reads r ON(t.id = r.threadId AND r.readUser = '{$_SESSION['userId']}')" : ' FROM forum_threads t').		' WHERE (state = \'sticky\')'.($showNew ? ' AND (t.time > r.readTime OR r.readTime IS NULL) ' : '').$threadBox['extra'].$_SESSION['plexpediaGroup']['sql'].$_SESSION['plexpediaGroup']['sqlContent'].' ORDER BY time DESC LIMIT 5';	//$sql = "SELECT `id`, `title`, `type`, `userId`, `time` FROM `forum_threads` WHERE `submitTime` != ''".($_SESSION['plexpediaGroup']['id'] ? ' '.$_SESSION['plexpediaGroup']['sql'] : /*' AND groupId = \'\''*/'')." AND `state` = 'active' ORDER BY `time` DESC LIMIT 15";			if($rs = $_SERVER['db']->execute($sql)) {		$items = $rs->recordCount();		if($items) {			$itemList .= '<div style="height:20px;" class="desc">Featured Content:</div>';						while ($item = $rs->FetchRow()) {			(($shownItems++ % 2) == 0) ? $class = 'even' : $class = 'odd';			$user = renderUser($item['userId']);			$itemList .= '			<a href="/view-'.$item['id'].'" class="'.$class.'" style="height:50px; display:block; text-decoration:none; width:98%;">				<div style="float:left; width:50px; height:50px; margin-left:5px; margin-right:15px; background-position:center; background-repeat:no-repeat; background-image:url('.($item['picture'] ? $item['picture'] : '/img/icon'.$item['type'].'.png').');" ></div>				<div class="boldText" style="margin-top:5px; height:30px; text-align:left;">					'.(isLoggedIn() ? ($item['readTime'] ? ($item['time'] > $item['readTime'] ? '+' : '') : '*') : '').' 					'.strip_tags($item['title']).'				</div>				<div class="desc" style="text-align:right; margin-right:5px;">By '.$user['userName'].' - '.doDate($item['time'],'short').'</div>			</a>			';		}		$itemList .= '<br />';	}	}	}			$sql = "		SELECT t.id, t.title, t.type, t.tags, t.description, t.state, t.submitTime, t.userId, t.views, t.picture, t.time".		(isLoggedIn() ? ", r.readTime FROM forum_threads t LEFT JOIN forum_reads r ON(t.id = r.threadId AND r.readUser = '{$_SESSION['userId']}')" : ' FROM forum_threads t').		' WHERE (state = \'active\' OR state = \'resolved\')'.($showNew ? ' AND (t.time > r.readTime OR r.readTime IS NULL) ' : '').$threadBox['extra'].$_SESSION['plexpediaGroup']['sql'].$_SESSION['plexpediaGroup']['sqlContent'].' ORDER BY state ASC, time DESC LIMIT 15';	//$sql = "SELECT `id`, `title`, `type`, `userId`, `time` FROM `forum_threads` WHERE `submitTime` != ''".($_SESSION['plexpediaGroup']['id'] ? ' '.$_SESSION['plexpediaGroup']['sql'] : /*' AND groupId = \'\''*/'')." AND `state` = 'active' ORDER BY `time` DESC LIMIT 15";		$itemList .= '<div style="height:20px;" class="desc">'.(isLoggedIn() ? ($_REQUEST['c'] == 'r' ? '<a href="index" class="stxt rflt">» Show New to Me</a>Recent Content' : '<a href="index-c-r" class="stxt rflt">» Show Recent</a>New to Me') : 'Recent Content').':</div>';		if($rs = $_SERVER['db']->execute($sql)) {		$items = $rs->recordCount();		if(!$items) {			if($showNew) $itemList .= '<div class="nbox">You are caught up on all this site\'s content!<br /><br /><a href="/browse" class="lbtn">Browse All Content</a></div>';		}		else while ($item = $rs->FetchRow()) {			(($shownItems++ % 2) == 0) ? $class = 'even' : $class = 'odd';			$user = renderUser($item['userId']);			$itemList .= '			<a href="/view-'.$item['id'].'" class="'.$class.'" style="height:50px; display:block; text-decoration:none; width:98%;">				<div style="float:left; width:50px; height:50px; margin-left:5px; margin-right:15px; background-position:center; background-repeat:no-repeat; background-image:url('.($item['picture'] ? $item['picture'] : '/img/icon'.$item['type'].'.png').');" ></div>				<div class="boldText" style="margin-top:5px; height:30px; text-align:left;">					'.(isLoggedIn() ? ($item['readTime'] ? ($item['time'] > $item['readTime'] ? '+' : '') : '*') : '').' 					'.strip_tags($item['title']).'				</div>				<div class="desc" style="text-align:right; margin-right:5px;">By '.$user['userName'].' - '.doDate($item['time'],'short').'</div>			</a>			';		}	}		setPageConst('itemList',$itemList,'index');}?>