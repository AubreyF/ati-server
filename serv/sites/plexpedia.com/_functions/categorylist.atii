<?//************************************************************//***** This function returns a nice list of categories ******//** All you have to give it is the sql for finding them! ****//************************************************************function categorylist($id,$children=0) {		$sql = (!$_SESSION['groupName'] ? 'AND minPowerBrowse <= '.$_SESSION['userPower'] : ((!isAdmin() && $_SESSION['plexpediaGroup']['usId'] != $_SESSION['userId'] && !$_SERVER['db']->getOne('SELECT groupId FROM group_members WHERE userId = "'.$_SESSION['userId'].'" AND groupId = "'.$_SESSION['plexpediaGroup']['id'].'"')) ? 'AND access <= 2' : ''));		if($_SESSION['groupName']) $categories = func(_mod.'dbtree','getChildTreeArray','group_categories',$id,$_SESSION['plexpediaGroup']['groupSql'].$sql." ORDER BY title ASC",$children);	else $categories = func(_mod.'dbtree','getChildTreeArray','forum_categories',$id,$sql."ORDER BY title ASC",$children);		if($categories) {	$catList .= '<table width="100%" border="0" cellspacing="0" cellpadding="2"><tr>';		foreach ($categories as $key=>$cat) {			//Count the ads in this category			$rs = $_SERVER['db']->execute("SELECT id FROM forum_threads WHERE cid = $cat[id] AND `state` = 'active'");			$ads = $rs->RecordCount();						$catList .= '<td valign="top"><a class="category" title="'.$cat['title'].' - '.$cat['description'].'" href="/browse-cat-'.$cat['id'].'"><img src="/img/folderold.png"/> '.$cat['title'].'</a>';						if ($cat['children']) { //Without this line, childless categories will trigger php error messages!				foreach ($cat['children'] as $subCat) {					$catList .= '<a class="subcategory" title="'.$subCat['title'].' - '.$subCat['description'].'" href="/browse-cat-'.$subCat['id'].'"><img src="/img/foldersmallold.png" /> '.$subCat['title'].'</a>';				}			}						$catList .= '</td>';						$counter ++;			if ($counter % 4 == 0) $catList .= '</tr><tr>';		}		$catList .= '</tr></table>';		return $catList;	}}function simplifiedCategoryList($boxTitle,$id) { 	 	//build category list		if($_SESSION['groupName']) $categories = func(_mod.'dbtree','getChildTreeArray','group_categories',$id,$_SESSION['plexpediaGroup']['groupSql']);	else $categories = func(_mod.'dbtree','getChildTreeArray','forum_categories',$id);		if($categories) {		$catlist .= '<ul>';		foreach ($categories as $key=>$cat) {			//Count the ads in this category			$rs = $_SERVER['db']->execute("SELECT id FROM forum_threads WHERE cid = $cat[id]");			$ads = $rs->RecordCount();			(($counter++ % 2) == 0) ? $class = '"odd"' : $class = '"even"';			$catList .= '<li><a title="'.$cat['title'].' - '.$cat['description'].'" href="/browse-cat-'.$cat['id'].'">'.$cat['title'].'</a> <em>('.$ads.' ads)</em></li>';		}		$catlist .= '</ul>';		return('<h4>'.$boxTitle.'</h4>'.$catList);	}}function categoryTree() {		$rs = $_SERVER['db']->execute("SELECT * FROM ".($_SESSION['groupName'] ? 'group_categories' : 'forum_categories')." ORDER BY `title`");	if ($rs) {		while ($cat = $rs->FetchRow()) {			$categories .= "categories.add({$cat[id]},{$cat[parent]},'{$cat[title]}','/browse-cat-{$cat['id']}','{$cat['description']}', '_parent');";		}		}		return '	<link rel="StyleSheet" href="/_inc/dtree/dtree.css" type="text/css" />	<style type="text/css">	body {		background-color:#0E4B88;	}	.dtree a{		color:#FFFFFF;		text-decoration: none;	}	.dtree a.node:hover, .dtree a.nodeSel:hover {		color:#CCCCCC;		text-decoration: underline;	}	.dtree a.nodeSel {		font-weight:bold;		text-decoration: underline;		background-color:#0E4B88;	}	</style>		<style type="text/css">	.dtree a{		color:#FFFFFF;		text-decoration: none;	}	.dtree a.node:hover, .dtree a.nodeSel:hover {		color:#CCCCCC;		text-decoration: underline;	}	.dtree a.nodeSel {		font-weight:bold;		text-decoration: underline;		background-color:#0E4B88;	}	</style>	<script type="text/javascript" src="/_inc/dtree/dtree.js"></script>		<script type="text/javascript">	<!--	categories = new dTree(\'categories\');	categories.config.closeSameLevel = true;	categories.add(0,-1,\'Home\',\'/index\',\'PlexPedia Home\',\'_parent\');	'.$categories.'	document.write(categories);		lastCategory = parent.document.getElementById(\'lastCategoryID\').value;		if(lastCategory) {		categories.openTo(lastCategory, true);	}	//-->	</script>	';}function categorySelect($url,$sql) {	$rs = $_SERVER['db']->execute('SELECT * FROM `'.($_SESSION['groupName'] ? 'group_categories' : 'forum_categories').'` WHERE 1 '.(!$_SESSION['groupName'] ? ' AND minPowerSubmit <= '.$_SESSION['userPower'] : ((!isAdmin() && $_SESSION['plexpediaGroup']['usId'] != $_SESSION['userId'] && !$_SERVER['db']->getOne('SELECT groupId FROM group_members WHERE userId = "'.$_SESSION['userId'].'"')) ? ' AND access = 1' : '').''.$_SESSION['plexpediaGroup']['groupSql']).' '.$sql.' ORDER BY `title`');	if ($rs) {		while ($cat = $rs->FetchRow()) {			$catCount++;			if($cat['minPowerView'] > $_SESSION['userPower']) continue;			else if($cat['minPowerSubmit'] > $_SESSION['userPower']) $categories .= "categories.add({$cat[id]},{$cat[parent]},'{$cat[title]}','','{$cat['description']}');\n";			else $categories .= "categories.add({$cat[id]},{$cat[parent]},'{$cat[title]}','{$url}{$cat['id']}','{$cat['description']}');\n";		}	}		return '	<link rel="StyleSheet" href="/_inc/dtree/dtree.css" type="text/css" />	<script type="text/javascript" src="/_inc/dtree/dtree.js"></script>	<script type="text/javascript">	<!--	categories = new dTree(\'categories\');	categories.config.closeSameLevel = true;	categories.add(0,-1,\'Categories\');	'.$categories.'	categories.add(99999,0,\'None\',\''.$url.'0\',\'\');	document.write(categories);	'.($catCount < 30 ? 'categories.openAll();' : '').'	//-->	</script>	';}function categoryOptions($current=0, $sql="", $pid=0, $levels="") {	$rs = $_SERVER['db']->execute('SELECT * FROM `'.($_SESSION['groupName'] ? 'group_categories' : 'forum_categories').'` WHERE parent = '.$pid.' '.(!$_SESSION['groupName'] ?  'AND (type = \'\' OR type = \''.$item['type'].'\') AND minPowerSubmit <= '.$_SESSION['userPower'] : ((!isAdmin() && $_SESSION['plexpediaGroup']['usId'] != $_SESSION['userId'] && !$_SERVER['db']->getOne('SELECT groupId FROM group_members WHERE userId = "'.$_SESSION['userId'].'"')) ? ' AND access = 1' : '').''.$_SESSION['plexpediaGroup']['groupSql']).' '.$sql.' ORDER BY `title`');		if ($rs) {		while ($cat = $rs->FetchRow()) {			if($cat['minPowerView'] > $_SESSION['userPower'] || $cat['minPowerSubmit'] > $_SESSION['userPower']) continue;			$categories .= '<option value="'.$cat['id'].'"'.($cat['id'] == $current ? ' selected' : '').'>'.($levels ? $levels.'> ' : '').$cat['title'].'</option>'.categoryOptions($current, $sql, $cat['id'], $levels.'-');		}	}		return $categories;}?>