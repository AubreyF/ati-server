<?function imageUploader($imageName,$width=640,$height=480,$preserveFull=false) {	if($width == 'thumb') {		$doThumb = true;		$doFull = false;		//$doOrig = false;	}	else if($width == 'full') {		$doThumb = false;		$doFull = false;	}	else {		$doThumb = true;		$doFull = true;	}		if( !$_FILES[$imageName]['tmp_name'] || !$_FILES[$imageName]['size'] ) return 1;  //You forgot to specify an image!		//********************** Verify mime types and determine file extension ***********************		if(!($_FILES[$imageName]['type'] == "image/pjpeg" || $_FILES[$imageName]['type'] == "image/jpeg" || $_FILES[$imageName]['type'] == "image/x-png" || $_FILES[$imageName]['type'] == "image/png" || $_FILES[$imageName]['type'] == "image/gif")) return 2;  //not valid image file!		//***************************** Do Filename **************************		$badString = array ( 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, '!', ',', '-', '/', ':', '_', ' ', 'thumb', '.', 'jpg', 'png', 'jpeg', 'gif', 'bmp', 'swf','$','#','@','*','(',')');	$fileName = str_replace( $badString, '', strtolower(substr($_FILES[$imageName]['name'],0,20)) ); // Remove Nonsense	$fileName = str_replace(" ", "_", $fileName); // Convert Spaces	$fileName = $_SESSION['userName'].$fileName;		while( file_exists( _root.'/data/uploads/'.$fileName.'.jpg' ) || file_exists( _root.'/data/uploads/'.$fileName.'-thumb.jpg') || file_exists( _root.'/data/uploads/'.$fileName.'-orig.jpg' ) ) { //make sure we are not overwriting other files...		$fileName .= chr( mt_rand( 97, 122 ) ); //add random lowercase letter to filename	}		$fullTemporaryName = $_FILES[$imageName]['tmp_name'];	$thumbName = $fileName.'-thumb.jpg';	$fullThumbName = _root.'/data/uploads/'.$thumbName;	$origName = $fileName.'-orig.jpg';	$fullOrigName = _root.'/data/uploads/'.$origName;	$fileName .= '.jpg';	$fullFileName = _root.'/data/uploads/'.$fileName;		//********************** GENERATE THUMBNAIL IMAGE *********************		if($doThumb) {		exec("{$_SERVER['imagemagickpath']}convert -size 100X75 {$fullTemporaryName} -resize 100X75 -quality 80% {$fullThumbName}");		}		//************************* GENERATE FULL IMAGE ***********************		if($doFull) {		exec("{$_SERVER['imagemagickpath']}convert {$fullTemporaryName} -resize {$width}X{$height}\> -quality 90% {$fullFileName}");	}		//******** Move original uploaded file to permanant location **********		if($preserveFull) {		move_uploaded_file($fullTemporaryName, $fullOrigName);		chmod($fullOrigName, 0644);	}	else {		exec("{$_SERVER['imagemagickpath']}convert {$fullTemporaryName} -resize 1280X800\> -quality 90% ".$fullOrigName);	}		//************************* return The Value!!! ***********************		if(/*($doFull && !is_readable( $fullFileName )) || !is_readable($fullThumbName)*/!is_readable($fullOrigName)) { //ImageMagic Failed!		return 3;	}		unlink($fullTemporaryName); //Remove temporary file		if($doFull == true) return '/_upl/'.$fileName;	else if($doThumb == true) return '/_upl/'.$thumbName;	else return '/_upl/'.$origName;}function imageScraper($url,$width=640,$height=480) {	if($width == 'thumb') {		$width = 100;		$height = 75;	}		//***************************** Do Filename **************************		$badString = array ( 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, '!', ',', '-', '/', ':', '_', ' ', 'thumb', '.', 'jpg', 'png', 'jpeg', 'gif', 'bmp', 'swf','$','#','@','*','(',')');	$fileName = $_SESSION['userName'].str_replace($badString, '', strtolower(substr($url,0,20))); // Remove Nonsense	while(file_exists( _root.'/data/uploads/'.$fileName.'.jpg')) { //make sure we are not overwriting other files...		$fileName .= chr( mt_rand( 97, 122 ) ); //add random lowercase letter to filename	}	$fileName .= '.jpg';	$fullFileName = _root.'/data/uploads/'.$fileName;		//************************* GENERATE FULL IMAGE ***********************		if(substr($url,0,7) != 'http://') $url = 'http://theati.net/'.$url;	copy($url, $fullFileName);	//die("{$url}---{$fullFileName}---{$_SERVER['imagemagickpath']}mogrify -resize {$width}X{$height}\> -quality 90% -format jpg {$fullFileName}");	exec("{$_SERVER['imagemagickpath']}mogrify -resize {$width}X{$height}\> -quality 90% -format jpg {$fullFileName}");	return '/_upl/'.$fileName;}//****************** This function will return the thumbnail image src **************************function getThumbnailImageName($image) {	if(!$image) return;	if (strpos($image,'-thumb.')) return $image;		$image = str_replace('-thumb','', $image);	$image = explode('.',$image);		foreach ($image as $key => $value) {				if($key == (count($image) - 2)) $value .= '-thumb';				if($key < (count($image) - 1)) $value .= '.';				$newImage .= $value;	}		return $newImage;}function getFullImageName($image) {	$image = str_replace('-thumb','', $image);	return $image;}?>